<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="../node_modules/mocha/mocha.css" />
  </head>
  <body>
    <div id="mocha"></div>
    <script type="application/javascript">
      var Mocha = require('mocha');
      var fs = require('fs');
      var join = require('path').join;
      // merge underscore and underscore string functions
      var _ = require('lodash');
      var _str = require('underscore.string');
      _.mixin(_str.exports());

      process.env.NODE_ENV = 'test';

      // init mocha
      var mocha = new Mocha();

      // search for test files to include
      function lookupFiles(path) {
        var stat = fs.statSync(path);
        if (stat.isFile()) {
          if (path.substr(-3) === '.js') mocha.addFile(path)
          return;
        }
        fs.readdirSync(path).forEach(function(file){
          file = join(path, file);
          var stat = fs.statSync(file);
          if (stat.isDirectory()) {
            lookupFiles(file);
          }
          if (!stat.isFile() || file.substr(-3) !== '.js') return;
          mocha.addFile(file)
        });
      }
      lookupFiles('script');

      // Run test and display results in the page
      global.document = window.document;
      mocha.ui('bdd').reporter('html').run();
    </script>
  </body>
</html>