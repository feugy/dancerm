<div class="invoice">
  <article class="focusable invoice-title">
    <h2 class="title" data-ng-if="!ctrl.isReadOnly">
      {{'ttl.invoice'|i18n:{args:{ref:''} } }}
      <input type="text" data-ng-model="ctrl.invoice.ref" data-ng-change="ctrl._onChange('ref')"/>
    </h2>
    <span class="row" data-ng-if="!ctrl.isReadOnly">
      <span class="col-md-3 selected-school">
        <label>{{::'lbl.selectedSchool'|i18n:{sep:true} }}</label>
        <div class="btn-group" data-dropdown keyboard-nav>
          <button class="btn dropdown-toggle" dropdown-toggle>{{'lbl.schools[' + ctrl.selectedSchool + '].owner'|i18n}}<span class="caret"></span></button>
          <ul class="dropdown-menu">
            <li data-ng-repeat="school in ::ctrl.i18n.lbl.schools"><a href="" data-ng-click="ctrl.selectSchool($index)">{{::school.owner}}</a></li>
          </ul>
        </div>
      </span>
      <span class="col-md-2 with-vat">
        <label><input type="checkbox" data-ng-model="ctrl.withVat"/>{{::'lbl.withVat'|i18n}}</label>
      </span>
      <span class="col-md-7 suggested">
        <span data-ng-show="ctrl.suggestedRef">{{'lbl.suggestedRef'|i18n:{args:{ref:ctrl.suggestedRef} } }}</span>
      </span>
    </span>
    <h2 class="title" data-ng-if="ctrl.isReadOnly">{{'ttl.invoice'|i18n:{args:ctrl.invoice} }}</h2>
  </article>

  <div class="preview" data-ng-if="!ctrl.isReadOnly">
    <header>
      <img src="../style/img/ribas.png" class="logo"/>
      <div class="school">
        <p>{{'lbl.schools[' + ctrl.selectedSchool + '].name'|i18n}}</p>
        <p>{{'lbl.schools[' + ctrl.selectedSchool + '].street'|i18n}}</p>
        <p>{{'lbl.schools[' + ctrl.selectedSchool + '].zipcode'|i18n}} {{'lbl.schools[' + ctrl.selectedSchool + '].city'|i18n}}</p>
        <p>{{'lbl.schools[' + ctrl.selectedSchool + '].phone'|i18n}}</p>
        <p>{{'lbl.schools[' + ctrl.selectedSchool + '].siret'|i18n}}</p>
        <p>{{'lbl.schools[' + ctrl.selectedSchool + '].vat'|i18n}}</p>
      </div>
      <div class="customer">
        <p>
          <input type="text" data-ng-model="ctrl.invoice.customer.name" data-ng-change="ctrl._onChange('customer.name')" data-set-null/>
        </p>
        <p>
          <input type="text" data-ng-model="ctrl.invoice.customer.street" data-ng-change="ctrl._onChange('customer.street')" data-set-null/>
        </p>
        <p class="zip-and-city">
          <input type="number" data-ng-model="ctrl.invoice.customer.zipcode" data-ng-change="ctrl._onChange('customer.zipcode')" data-set-null/>
          <input type="text" data-ng-model="ctrl.invoice.customer.city" data-ng-change="ctrl._onChange('customer.city')" data-set-null/>
        </p>
    </header>
    <div class="date">
      <span class="input-group ng-class:ctrl.dateOpts.open?'open':'';">{{::'print.invoiceDate'|i18n}}
        <input type="text"
          data-set-null
          data-datepicker-popup="{{::'formats.invoiceSelection'|i18n}}"
          data-is-open="ctrl.dateOpts.open"
          data-ng-model="ctrl.dateOpts.value"
          data-show-button-bar="false"
          data-datepicker-options="::ctrl.dateOpts"
          data-popup-placement="right"
          data-ng-change="ctrl.setDate()"/>
        <a href="" class="input-group-addon" data-ng-click="ctrl.toggleDate($event)"><i class="glyphicon glyphicon-calendar"></i></a></span>
    </div>
    <div class="row item-header">
      <span class="col-md-5 name">{{::'lbl.designation'|i18n}}</span>
      <span class="col-md-1 quantity">{{::'lbl.quantity'|i18n}}</span>
      <span class="col-md-2 price">{{::'lbl.unitaryPrice'|i18n}}</span>
      <span class="col-md-2 vat">{{::'lbl.vatValue'|i18n}}</span>
      <span class="col-md-2 total">{{::'lbl.totalPrice'|i18n}}</span>
    </div>
    <invoice-item
      data-ng-repeat="item in ctrl.invoice.items"
      data-src="item"
      data-on-remove="ctrl.removeItem(item)"
      data-on-change="ctrl._onChange('items[' + $index + '].' + $field)">
    </invoice-item>
    <div class="row add-item">
      <span class="col-md-8">
        <button class="btn glyphed" data-ng-click="ctrl.addItem()"><i class="glyphicon glyphicon-plus"/>{{::'btn.addInvoiceItem'|i18n}}</button>
      </span>
      <span class="col-md-2">{{::'lbl.dutyFreeTotal'|i18n}}</span>
      <span class="col-md-2">{{ctrl.invoice.dutyFreeTotal|number|i18n:{currency:true} }}</span>
    </div>
    <div class="row add-item">
      <span class="col-md-2 col-md-offset-8">{{::'lbl.taxTotal'|i18n}}</span>
      <span class="col-md-2">{{ctrl.invoice.taxTotal|number|i18n:{currency:true} }}</span>
    </div>
    <div class="row add-item">
      <span class="col-md-2 col-md-offset-8">{{::'lbl.invoiceTotal'|i18n}}</span>
      <span class="col-md-2">{{ctrl.invoice.total|number|i18n:{currency:true} }}</span>
    </div>
  </div>
  <div class="preview" data-ng-if="ctrl.isReadOnly">
    <header>
      <img src="../style/img/ribas.png" class="logo"/>
      <div class="school">
        <p>{{::'lbl.schools[' + ctrl.selectedSchool + '].name'|i18n}}</p>
        <p>{{::'lbl.schools[' + ctrl.selectedSchool + '].street'|i18n}}</p>
        <p>{{::'lbl.schools[' + ctrl.selectedSchool + '].zipcode'|i18n}} {{::'lbl.schools[' + ctrl.selectedSchool + '].city'|i18n}}</p>
        <p>{{::'lbl.schools[' + ctrl.selectedSchool + '].phone'|i18n}}</p>
        <p>{{::'lbl.schools[' + ctrl.selectedSchool + '].siret'|i18n}}</p>
        <p>{{::'lbl.schools[' + ctrl.selectedSchool + '].vat'|i18n}}</p>
      </div>
      <div class="customer">
        <p>{{ctrl.invoice.customer.name}}</p>
        <p>{{ctrl.invoice.customer.street}}</p>
        <p>{{ctrl.invoice.customer.zipcode}} {{ctrl.invoice.customer.city}}</p>
    </header>
    <div class="date">
      <span>{{'print.invoiceDate'|i18n}} {{::ctrl.displayDate()}}</span>
    </div>
  </div>
</div>